@model DQueensFashion.Models.EditProductImageViewModel

@using DQueensFashion.Utilities

@{
    ViewBag.Title = "EditProductImages";
    Layout = "~/Views/Shared/_dashboardLayout.cshtml";
}

<script src="~/Content/js/jquery.js"></script>
<div style="font-size:20px;font-weight:700">@Model.ProductName</div>
<div style="font-size:15px;font-weight:500">@Model.ProductCategory</div>

@using (Html.BeginForm("EditProductImages", "Admin", null, FormMethod.Post, new { enctype = "multipart/form-data" }))
{
    @Html.AntiForgeryToken()

    <div class="form-horizontal">
        @Html.HiddenFor(model => model.ProductId)
        @Html.ValidationSummary(true, "", new { @class = "text-danger" })

        <div>
            <table id="images-table" class="table table-responsive">
                <tbody></tbody>
            </table>
            <button id="addNewImage" type="button">Add New Image</button>
            <br /><br />
        </div>


        <div class="form-group">
            <div class="">
                <input type="submit" value="Add images" class="btn"  style="background-color:#E97128;color:white" />
            </div>
        </div>
    </div>
}


@Html.Partial("_productImages", Model.ProductImages)


@section Scripts {
    @Scripts.Render("~/bundles/jqueryval")
}

<script type="text/javascript">

    var hidden = '@Html.Hidden("Images.Index", "{id}")';
    var fileHtml = ' <input id="Images[{id}].File" name="Images[{id}].ImagePath" type="file" accept="image/x-png,image/gif,image/jpeg" required/>';

    $("#addNewImage").on("click", function () {

            var time = Date.now();

            var deleteHtml = "<button type='button' onclick='deleteImageRow(this)' style='color:red'>Delete</button>";

            $("#images-table").find("tbody")
             .append($("<tr> <td>" + hidden.replace("{id}", time) + deleteHtml + "</td>" +
                 "<td>" + "</td>" +
                 "<td>" + fileHtml.replace("{id}", time) +
                 "</td></tr>"));
    });


    function deleteImageRow(el) {
        if (confirm('Are you sure you want to remove this image?')) {
            $(el).closest("tr").remove();
        }
    }

    function DeleteProductImage(imageId) {

        $.ajax({
            url: '/Admin/DeleteProductImage/',
            dataType: "html",
            data: { id:imageId },
            success: function (result) {
                $("#productImages").html(result);
            },
            error: function (xhr, status, error) {
                alertify.error("Error");
            }
        });
    }

</script>