@model DQueensFashion.Models.EditProductImageViewModel

@using DQueensFashion.Utilities

@{
    ViewBag.Title = "Edit Product Images";
    Layout = "~/Views/Shared/_dashboardLayout.cshtml";
}

<script src="~/Content/js/jquery.js"></script>

<div class="edit-product-image-product-name">@Model.ProductName</div>
<div class="edit-product-image-product-category">@Model.ProductCategory</div>
<hr class="m-0" />
<div class="text-danger">Images should not be more than 10MB</div>

@using (Html.BeginForm("EditProductImages", "Admin", null, FormMethod.Post, new { enctype = "multipart/form-data" }))
{
    @Html.AntiForgeryToken()

    <div class="form-horizontal">
        @Html.HiddenFor(model => model.ProductId)
        @Html.ValidationSummary(true, "", new { @class = "text-danger" })

        <div>
            <table id="images-table" class="table table-responsive">
                <tbody></tbody>
            </table>
            <button id="addNewImage" type="button">Add New Image</button>
            <br /><br />
        </div>

        <hr />
        <div class="form-group">
            <div class="">
                <input type="submit" value="SAVE NEW IMAGES" class="btn secondary-table-button" />
            </div>
        </div>
    </div>
}

<hr class="mb-5" />
<h4>PREVIOUS IMAGES</h4>
<hr class="mt-0"/>

@Html.Partial("_productImages", Model.ProductImages)


@section Scripts {
    @Scripts.Render("~/bundles/jqueryval")
}

<script type="text/javascript">

    var hidden = '@Html.Hidden("Images.Index", "{id}")';
    var fileHtml = ' <input id="Images[{id}].File" name="Images[{id}].ImagePath" type="file" accept="image/x-png,image/gif,image/jpeg" required/>';

    $("#addNewImage").on("click", function () {

            var time = Date.now();

            var deleteHtml = "<button type='button' onclick='deleteImageRow(this)' style='color:red'>Delete</button>";

            $("#images-table").find("tbody")
             .append($("<tr> <td>" + hidden.replace("{id}", time) + deleteHtml + "</td>" +
                 "<td>" + "</td>" +
                 "<td>" + fileHtml.replace("{id}", time) +
                 "</td></tr>"));
    });


    function deleteImageRow(el) {
        if (confirm('Are you sure you want to remove this image?')) {
            $(el).closest("tr").remove();
        }
    }

    function DeleteProductImage(imageId) {

        if (confirm('Are you sure you want to delete this image, the image will be deleted permanently')) {
             $.ajax({
            url: '/Admin/DeleteProductImage/',
            dataType: "html",
            data: { id:imageId },
            success: function (result) {
                $("#productImages").html(result);
            },
            error: function (xhr, status, error) {
                ShowSnackbarError("Error");
            }
        });
        }

    }

</script>