@model DQueensFashion.Models.ProductIndexViewModel

@{
    ViewBag.Title = "Index";
    Layout = "~/Views/Shared/_Layout.cshtml";
}


<style>
    .collapsible {
        background-color: #0a0c13;
        color: white;
        cursor: pointer;
        padding: 18px;
        width: 100%;
        border: none;
        text-align: left;
        outline: none;
        font-size: 15px;
        border-top: 4px solid #E97128;
    }

        .collapsible:focus {
            outline: none;
        }

        .collapsible:after {
            content: '\002B';
            color: white;
            font-weight: bold;
            float: right;
            margin-left: 5px;
        }

    .active:after {
        content: "\2212";
    }

    .content {
        padding: 0 18px;
        max-height: 0;
        overflow: hidden;
        transition: max-height 0.5s ease-out;
        background-color: #f1f1f1;
    }

    .filter-btn{
        border:none;
    }

    .filter-btn:active,
    .filter-btn:focus{
        outline:none !important;
        border:none !important;
        box-shadow: none !important;
    }

</style>


<div class="container-fluid body-content">
    <div class="row">
        <div class="col-md-4 col-12 mb-3">
            <button class="collapsible active">FILTER</button>
            <div class="content" style="max-height:100vh;padding-bottom:10px">
                <div style="padding-top:10px">
                    <div class="col-12 mb-3">
                        <div class="form-row">
                            <label class="col-3 col-form-label" for="name">Search</label>
                            <input type="text" class="form-control col-9" id="searchString" />
                        </div>
                    </div>
                    <div class="col-12 mb-3">
                        <div class="form-row">
                            <label class="col-3 col-form-label" for="name">Category</label>
                            <select class="form-control col-9" id="categoryId">
                                <option value="0">All</option>
                                @foreach (var category in Model.Categories)
                                {
                                    <option value="@category.Id" selected="@category.Selected">@category.Name</option>
                                }
                            </select>
                        </div>
                    </div>
                    <div class="col-12 mb-3">
                        <div class="form-row">
                            <label class="col-3 col-form-label" for="name">Sort by</label>
                            <select class="form-control col-9" id="sortString">
                                <option value="1">Best selling</option>
                                <option value="2">Alphabetically, A - Z</option>
                                <option value="3">Alphabetically, Z - A</option>
                                <option value="4">Price, low to high</option>
                                <option value="5">Price, high to low</option>
                                <option value="6">Date, new to old</option>
                                <option value="7">Date, old to new</option>
                            </select>
                        </div>
                    </div>
                    <div class="col-12">
                        <button class="btn btn-block filter-btn" onclick="SearchProduct()" id="btnFilter" style="background-color:#E97128;color:white;width:100%" >FILTER <img src="~/Content/Images/filter.svg" /></button>
                    </div>
                </div>

            </div>

        </div>
        <div class="col-md-8 col-sm-12">

            <div id="productsList">
                <div class="row" id="">
                    @foreach (var product in Model.Products)
                    {
                        <div class="col-md-4 col-6">
                            <div class="card">
                                <div class="product">
                                    <a href="@Url.Action("ProductDetails","Product",new { id= product.Id})" class="atag">
                                        <img class="product_img" src="@Url.Content(product.Image1)" alt="product_img">
                                        <div class="product_info">
                                            <h6 class="product_title">@product.Name</h6>
                                            <strong class="product_price">@product.Price</strong>
                                        </div>
                                    </a>
                                    <hr style="margin:0">
                                    <div style="margin:5px 5px;cursor:pointer" class="float-right" onclick="AddToCart(@product.Id)">
                                        <img src="~/Content/Images/shopping-cart (orange).svg" class="product_button">
                                    </div>
                                    <div style="margin:5px 5px;cursor:pointer" class="float-right" onclick="AddToWishList(@product.Id)">
                                        <img src="~/Content/Images/heart.svg" class="product_button">
                                    </div>
                                    <div style="margin:5px 5px;cursor:pointer" class="float-right" onclick="productQuickView(@product.Id)">
                                        <img src="~/Content/Images/eye.svg" class="product_button">
                                    </div>
                                </div>
                            </div>
                        </div>
                    }
                    @{
                        if (Model.Products.Count() == 0)
                        {
                            <h4>No item</h4>
                        }
                    }
                </div>
                @*@for (int i = 1; i <= ViewBag.NumberOfPages; i++)
        {
            if (i == ViewBag.CurrentPage)
            {
                @i
            }
            else
            {
                <div style="cursor:pointer;color:blue" class="page-number" onclick="ProductPagination(@i)">@i</div>
            }
        }*@

                <nav aria-label="Page navigation" class="mt-3">
                    <ul class="pagination justify-content-center">
                        @{
                            if (ViewBag.CurrentPage == 1)
                            {
                                <li class="page-item disabled">
                                    <div class="page-link" href="#" aria-label="Previous">
                                        <span aria-hidden="true">&laquo;</span>
                                        <span class="sr-only">Previous</span>
                                    </div>
                                </li>
                            }
                            else
                            {
                                <li class="page-item">
                                    <div style="cursor:pointer" class="page-link" aria-label="Previous" onclick="ProductPagination(@ViewBag.CurrentPage-1)">
                                        <span aria-hidden="true" style="color:#0a0c13">&laquo;</span>
                                        <span class="sr-only">Previous</span>
                                    </div>
                                </li>
                            }

                            for (int pageNo = 1; pageNo <= ViewBag.NumberOfPages; pageNo++)
                            {


                                if (pageNo == ViewBag.CurrentPage)
                                {
                                    <li class="page-item">
                                        <div style="background-color:#0a0c13;color:white" class="page-link">@pageNo</div>
                                    </li>
                                }
                                else
                                {
                                    <li class="page-item">
                                        <div style="cursor:pointer;color:#0a0c13" class="page-link" href="#" onclick="ProductPagination(@pageNo)">@pageNo</div>
                                    </li>
                                }
                            }

                            if (ViewBag.CurrentPage == ViewBag.NumberOfPages)
                            {
                                <li class="page-item disabled">
                                    <div class="page-link" href="#" aria-label="Next">
                                        <span aria-hidden="true">&raquo;</span>
                                        <span class="sr-only">Next</span>
                                    </div>
                                </li>
                            }
                            else
                            {
                                <li class="page-item">
                                    <div class="page-link" href="#" aria-label="Next" style="cursor:pointer" onclick="ProductPagination(@ViewBag.CurrentPage+1)">
                                        <span aria-hidden="true" style="color:#0a0c13">&raquo;</span>
                                        <span class="sr-only">Next</span>
                                    </div>
                                </li>
                            }
                        }



                    </ul>
                </nav>

            </div>

         

        </div>

    </div>

</div>



<!--modals-->
<!--quick view product-->
<div class="modal fade" id="productQuickView">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h3 class="modal-title">Product quick view</h3>
                <a href="#" class="close" data-dismiss="modal">&times;</a>
            </div>
            <div class="modal-body" id="productQuickViewBody">


            </div>


        </div>

    </div>

</div>

<script>

    var _searchString = document.getElementById("searchString");
    var _sortString = document.getElementById("sortString");
    var _categoryId = document.getElementById("categoryId");

    function SearchProduct() {
        $.ajax({
            url: '/product/searchproduct',
            dataType: "html",
            data: { searchString: _searchString.value, sortString: _sortString.value, categoryId: _categoryId.value },
            success: function (result) {
                $("#productsList").html(result);
            },
            error: function (xhr, status, error) {
                alert("Error");
            }
        });

    }

    function ProductPagination(pageNumber) {
        $.ajax({
            url: '/product/ProductPagination',
            dataType: "html",
            data: { searchString: _searchString.value, sortString: _sortString.value, categoryId: _categoryId.value, pageNumber: pageNumber },
            success: function (result) {
                $("#productsList").html(result);
                $(window).scrollTop(0);
            },
            error: function (xhr, status, error) {
                alert("Error");
            }
        });
    }

    function productQuickView(productId) {
        var url = "/Product/ProductQuickView/" + productId;

        $("#productQuickViewBody").load(url, function () {
            $("#productQuickView").modal("show");

        })
    }


    var coll = document.getElementsByClassName("collapsible");
    var i;

    for (i = 0; i < coll.length; i++) {
        coll[i].addEventListener("click", function () {
            this.classList.toggle("active");
            var content = this.nextElementSibling;
            if (content.style.maxHeight) {
                content.style.maxHeight = null;
            } else {
                content.style.maxHeight = content.scrollHeight + "px";
            }
        });
    }
</script>

